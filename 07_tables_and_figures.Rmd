\newpage
# TABLES & FIGURES



```{r cov}
cov <- read.csv("data/Tech report covariate table.csv")
names(cov) <- c("Covariate", "Level", "Definition")
# cov$Definition <- first_up(cov$Definition)
pdf <- knitr:::is_latex_output()

csasdown::csas_table(cov,  longtable = F,  escape = FALSE, font_size=9,  caption ="Candidate covariates recorded during line-transect surveys and definitions for each covariate level.")
```

```{r survey-sightings-sum}
sgt_sum <- all_ap_sf %>%  dplyr::group_by(Species) %>%
  dplyr::summarise(N = n(),
                    "Number of individuals" = sum(Group_Size),
                   "Mean group size (+/- SD)" = paste0(round(mean(Group_Size), 1), " (+/- ", round(sd(Group_Size), 1),")")
                   # "Std.err" = round(sd/sqrt(N),1),
  ) %>%
  as.data.frame() %>%
  dplyr::rename("Number of sightings" = N) %>%
  dplyr::select(-geometry) %>% 
    mutate(Species=first_up(as.character(Species)))

```


<!-- ```{r tab-survey-sightings-sum} -->
<!-- pdf <- knitr:::is_latex_output() -->
<!-- sgt_sum %>% -->
<!--   csasdown::csas_table(align=c('l','r','r','r'), longtable = F, escape = FALSE, font_size=9,  caption="Survey sightings summary. Number of sightings, number of individuals sighted and average group size (+/- standard deviation). All data presented are on-effort survey sightings unless otherwise noted.")%>% -->
<!--   kableExtra::column_spec(c(1:4), width = c("2in","1in","1in","1.2in")) -->
<!-- ``` -->

```{r df-hw}
sp <-  "humpback"
df.hw <- all_ap_sf %>% filter(Species %like% sp) %>% data.frame()

# if(file.exists("data/hw-models.Rdata")){
#   load("data/hw-models.Rdata")
# }else{

hw1.5.un.cos       <-ds(df.hw, key = "un", truncation = 1.5)   
hw1.5.hn           <-ds(df.hw, key = "hn", truncation = 1.5)    
# hw1.5.hr           <-ds(df.hw, key = "hr", truncation = 1.5)

# hw1.5.hn.vis       <-ds(df.hw, 1.5, key="hn", formula=~Visibility)
hw1.5.hn.visc       <-ds(df.hw, 1.5, key="hn", formula=~Clumped_Visibility)
# hw1.5.hn.g90c      <-ds(df.hw, 1.5, key="hn", formula=~Glare90)            
# hw1.5.hn.g90sw      <-ds(df.hw, 1.5, key="hn", formula=~glare_swath)
# hw1.5.hn.g45sw      <-ds(df.hw, 1.5, key="hn", formula=~glare_swath45)      # none fit      

# hw1.5.hn.bf        <-ds(df.hw, 1.5, key="hn", formula=~Beaufort)
# hw1.5.hn.bfc        <-ds(df.hw, 1.5, key="hn", formula=~Clumped_Beaufort)
# hw1.5.hn.szc        <-ds(df.hw, key = "hn", truncation = 1.5, formula=~Clumped_Group_Size)
# hw1.5.hn.obs       <-ds(df.hw, key = "hn", truncation = 1.5, formula=~Observer)

# hw1.5.hn.vis.g90c  <-ds(df.hw, key = "hn", truncation = 1.5, formula=~Visibility+Glare90)
# hw1.5.hn.v.g90c    <-ds(df.hw, key = "hn", truncation = 1.5, formula=~Clumped_Visibility+Glare90)
# hw1.5.hn.v.bf      <-ds(df.hw, key = "hn", truncation = 1.5, formula=~Clumped_Visibility+Beaufort)
hw1.5.hn.v.bfc      <-ds(df.hw, key = "hn", truncation = 1.5, formula=~Clumped_Visibility+Clumped_Beaufort)
hw1.5.hn.v.szc      <-ds(df.hw, key = "hn", truncation = 1.5, formula=~Clumped_Visibility+Clumped_Group_Size)
# hr.v2       <- ds(data=df.hw, truncation=2, key="hr", formula=~Clumped_Vis)
# un2         <- ds(data=df.hw, truncation=2, key="un")
# hr2         <- ds(data=df.hw, truncation=2, key="hr")
hw1.5.hn.v.obs   <- ds(data=df.hw, truncation=1.5, key="hn", formula=~Clumped_Visibility+Observer)
# 
# hr.bfc2     <- ds(data=df.hw,truncation=2,key = "hr", formula=~Clumped_Beaufort)
# hr.bfc.v2   <- ds(data=df.hw, truncation=2, key="hr", formula=~Clumped_Beaufort+Clumped_Vis)
# hr.obs2     <- ds(data=df.hw, truncation=2, key="hr", formula=~Observer)
# 
# hn.gl2      <- ds(data=df.hw, truncation=2, key="hn", formula=~glare)
# hn.v2       <- ds(data=df.hw, truncation=2, key="hn", formula=~Clumped_Vis)
# hn2         <- ds(data=df.hw, truncation=2, key="hn")
# 
# hr.gl2      <- ds(data=df.hw, truncation=2, key="hr", formula=~glare)
# hr.obs.bfc2 <- ds(data=df.hw, truncation=2, key="hr", formula=~Clumped_Beaufort+Observer)
# hn.v.bfc2   <- ds(data=df.hw, truncation=2, key="hn", formula=~Clumped_Beaufort+Clumped_Vis)


# save(
# hw1.5.un.cos    ,
# hw1.5.hn        ,
# hw1.5.hn.visc   ,
# # hw1.5.hn.v.bf,
# hw1.5.hn.v.bfc,
# hw1.5.hn.v.szc,
# hw1.5.hn.v.obs,
#   file="data/hw-models.RData")
# }

hw <- df.hw %>% dplyr::select(Region.Label,
                # Survey=SurveyID,
                Sample.Label = order,
                distance,
                Species,
                size = Group_Size,
                Clumped_Visibility#,
                # Clumped_Beaufort,
                # Glare90,
                # swell,
                # Observer
                )
# find transects with no sightings and create NA distance rows
obs <- full_join(hw, effort) #%>% #left_join(reg) %>% 

# un.2 <- ds(data=obs, truncation=2, key="un")
hw1.5.hn.v    <-ds(obs, key = "hn", truncation = 1.5, formula=~Clumped_Visibility, er_var = "O2")

# summary(un.2)
# encounter rate and group size
er <- hw1.5.hn.v$dht$individuals$summary[c(1:4),c(1,5,7,9,10)] %>% 
  transmute(Season=Region,
            n     =round(n,     digits=0), 
            ER    =round(ER   , digits=2),
            cv.ER =round(cv.ER, digits=2),
            GS=round(mean.size, digits=2)
            )
# abundance
Nhat_t <- hw1.5.hn.v$dht$individuals$N[c(1:4),c(1,2,4,5,6)] %>% 
  transmute(Season=Label,
            N=    round(Estimate,digits=0), 
            cv.N= round(cv,      digits=2),
            L95.N=round(lcl,     digits=0),
            U95.N=round(ucl,     digits=0))
# density
d <- hw1.5.hn.v$dht$individuals$D[c(1:4),c(1,2,5,6)]  %>% 
  transmute(Season=Label,
            D =    round(Estimate*25,digits=2),
            # cv.D = round(cv,         digits=2),
            L95.D= round(lcl*25,     digits=2),
            U95.D= round(ucl*25,     digits=2))

ab_hw <- full_join(er, Nhat_t) %>% full_join(d) %>% tibble::as_tibble() %>% dplyr::select(1:6,8:12,7)
# ab_hw <- ab_hw[order(ab_hw$N),]
```

```{r df-tab-hw}
model.table.hw <- summarize_ds_models(
 hw1.5.un.cos    ,
hw1.5.hn        ,
hw1.5.hn.visc   ,
# hw1.5.hn.v.bf, # must clump, too few samples in bf 0
hw1.5.hn.v.bfc,
hw1.5.hn.v.szc,
hw1.5.hn.v.obs,
  output="plain") %>% tibble::as_tibble()  %>% 
  rename("SE (Average detect.)"="se(Average detectability)",
         "Average detect."="Average detectability",
         "CvM p-value"="C-vM $p$-value") %>% 
  mutate(
    Formula=gsub("Clumped_","",Formula),
         Formula=gsub("Group_Size", "Group Size", Formula)
         # Formula=gsub("90c","",Formula)
    ) %>% dplyr::select(-Model)

# pdf <- knitr:::is_latex_output()
model.table.hw %>%
  csas_table(
    
    escape = FALSE, font_size=9,
             align = c("l","r","r","r","r","r"), digits=2,  longtable = F,
  caption = paste("Humpback whale detection function models; truncation distance=1.5 km. Comparison among models with strong support (i.e. delta AIC less than five). Key function, Formula=covariates in model, CvM p-value=Cramer-von-Mises test p-value, Average detect.=average detectability, SE(Average detect.)=standard error of the average detectability. Delta AIC= difference in AIC from the top performing model.")) %>%
  kableExtra::column_spec(c(1:6), width = c("2in", "1.2in",".5in",".7in","0.7in",".5in"))
```

```{r df-hp}
  sp <-  "harbour porpoise"
  df.hp <- all_ap_sf %>% filter(Species %like% sp) %>% 
    mutate(is.na(Reticle)) %>% data.frame()
  
#   if(file.exists("data/hp-models.Rdata")){
#   load("data/hp-models.Rdata")
# }else{
  # un0.65        <- ds(data=df.hp, truncation=0.65, key="un")
  # hn0.65        <- ds(data=df.hp, truncation=0.65, key="hn")
  # # hr0.65        <- ds(data=df.hp, truncation=0.65, key="hr")
  # 
  # hn.bfc0.65        <- ds(data=df.hp, truncation=0.65, key="hn", formula=~Clumped_Beaufort)
  # hn.v0.65        <- ds(data=df.hp, truncation=0.65, key="hn", formula=~Visibility)
  # # hn.vc0.65        <- ds(data=df.hp, truncation=0.65, key="hn", formula=~Clumped_Visibility)
  # hn.szc0.65        <- ds(data=df.hp, truncation=0.65, key="hn", formula=~Clumped_Group_Size)
  # hn.szc2.0.65        <- ds(data=df.hp, truncation=0.65, key="hn", formula=~Clumped_Group_Size2)
  # hn.obs0.65        <- ds(data=df.hp, truncation=0.65, key="hn", formula=~Observer)
  # 
  hn.bfc.obs0.65    <- ds(data=df.hp, truncation=0.65, key="hn", formula=~Clumped_Beaufort+Observer)
  # hn.bfc.v0.65      <- ds(data=df.hp, truncation=0.65, key="hn", formula=~Clumped_Beaufort+Visibility)
  # hn.bfc.szc0.65    <- ds(data=df.hp, truncation=0.65, key="hn", formula=~Clumped_Beaufort+Clumped_Group_Size)
  hn.bfc.obs.szc0.65  <- ds(data=df.hp, truncation=0.65, key="hn", formula=~Clumped_Beaufort+Observer+Clumped_Group_Size)
  hn.bfc.obs.v0.65  <- ds(data=df.hp, truncation=0.65, key="hn", formula=~Clumped_Beaufort+Observer+Visibility)
  # hn.bfc..obs0.65   <- ds(data=df.hp, truncation=0.65, key="hn", formula=~Clumped_Beaufort*Observer)
  
#   save(
#     # hn.bfc0.65 ,
#     hn.bfc.obs0.65    ,
#     hn.bfc.obs.szc0.65,
#     hn.bfc.obs.v0.65,
#     file="data/hp-models.RData")
# }
  
hp <- df.hp %>% dplyr::select(Region.Label,
                Sample.Label = order,
                distance,
                Species,
                size = Group_Size,
                Clumped_Beaufort,
                Observer)
# find transects with no sightings and create NA distance rows
obs <- full_join(hp, effort) #%>% #left_join(reg) %>% 

hp.0.65.hn.bfc.obs <- ds(data=obs, truncation=0.65, key="hn", formula=~Clumped_Beaufort+Observer, er_var = "S2")
# summary(hn.bfc.obs0.7)

# encounter rate and group size
er <- hp.0.65.hn.bfc.obs$dht$individuals$summary[c(1:4),c(1,5,7,9,10)] %>% 
  transmute(Season=Region,
            n     =round(n,         digits=0), 
            ER    =round(ER,        digits=2),
            cv.ER =round(cv.ER,     digits=2),
            GS=    round(mean.size, digits=2))
# abundance
Nhat_t <- hp.0.65.hn.bfc.obs$dht$individuals$N[c(1:4),c(1,2,4,5,6)] %>% 
  transmute(Season=Label,
            N=    round(Estimate,digits=0), 
            cv.N= round(cv,      digits=2),
            L95.N=round(lcl,     digits=0),
            U95.N=round(ucl,     digits=0))

# density
d <- hp.0.65.hn.bfc.obs$dht$individuals$D[c(1:4),c(1,2,5,6)] %>% 
  transmute(Season=Label,
            D =    round(Estimate*25,digits=2),
            # cv.D = round(cv,         digits=2),
            L95.D= round(lcl*25,     digits=2),
            U95.D= round(ucl*25,     digits=2))

ab_hp <- full_join(er, Nhat_t) %>% full_join(d) %>% tibble::as_tibble()  %>% dplyr::select(1:6,8:12,7)
# ab_hp_data <- ab_hp[order(ab_hp$N),]
```

```{r df-tab-hp}
sp="harbour porpoise"
model.table.hp <- summarize_ds_models(
#      un0.65     ,
#  hn0.65        ,
#  # hr0.65        ,
#  hn.bfc0.65 ,
#  hn.v0.65     ,
#  # hn.vc0.65  ,
#  hn.szc0.65     ,
#  hn.szc2.0.65   ,
#  hn.obs0.65     ,
#  
 hn.bfc.obs0.65 ,
#  hn.bfc.v0.65   ,
#  hn.bfc.szc0.65 ,
 hn.bfc.obs.szc0.65,
 hn.bfc.obs.v0.65  ,
#  hn.bfc..obs0.65   ,
  output="plain") %>% tibble::as_tibble()  %>% 
  rename("SE (Average detect.)"="se(Average detectability)",
         "Average detect."="Average detectability",
         "CvM p-value"="C-vM $p$-value") %>% 
  mutate(
    Formula=gsub("Clumped_","",Formula),
         Formula=gsub("Group_Size", "Group Size", Formula)) %>% dplyr::select(-Model)

pdf <- knitr:::is_latex_output()
model.table.hp %>%
  csas_table(
    
    escape = FALSE, font_size=9,
             align = c("l","r","r","r","r","r"), digits=2,  longtable = F,
  caption = paste("Harbour porpoise detection function models; truncation distance=0.65 km. Comparison among models with strong support (i.e. delta AIC less than five). Key function, Formula=covariates in model, CvM p-value=Cramer-von-Mises test p-value, Average detect.=average detectability, SE(Average detect.)=standard error of the average detectability. Delta AIC= difference in AIC from the top performing model.")) %>%
  kableExtra::column_spec(c(1:6), width = c("1.6in", "1.2in",".7in",".7in","0.7in",".7in"))

```

```{r df-dp}
sp <-  "Dall's porpoise"
df.dp <- all_ap_sf %>% filter(Species %like% sp) %>% data.frame()

# if(file.exists("data/dp-models.Rdata")){
# load("data/dp-models.Rdata")
# }else{
dp0.8.un       <-ds(df.dp, key = "un", truncation = 0.8)
dp0.8.hn       <-ds(df.dp, key = "hn", truncation = 0.8)
# dp0.8.hr       <-ds(df.dp, key = "hr", truncation = 0.8)

# dp0.8.hn.bfc           <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Beaufort)
# dp0.8.hn.v             <-ds(df.dp, 0.8, key="hn", formula=~Visibility)
# dp0.8.hn.szc        <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Group_Size)
dp0.8.hn.g90        <-ds(df.dp, 0.8, key="hn", formula=~Glare90)
# dp0.8.hn.g90y       <-ds(df.dp, 0.8, key="hn", formula=~Glare90y)                
# dp0.8.hn.g90c          <-ds(df.dp, 0.8, key="hn", formula=~Glare90)
# dp0.8.hn.g45c       <-ds(df.dp, 0.8, key="hn", formula=~Glare45)                
# dp0.8.hn.g45y        <-ds(df.dp, 0.8, key="hn", formula=~Glare45y)
# dp0.8.hn.sw           <-ds(df.dp, 0.8, key="hn", formula=~swell)
dp0.8.hn.swc         <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Swell)
dp0.8.hn.swc.g90c     <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Swell+Glare90)
# dp0.8.hn.swc.gl     <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Swell+glare_swath)
dp0.8.hn.swc.bfc      <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Swell+Clumped_Beaufort)
dp0.8.hn.swc.szc      <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Swell+Clumped_Group_Size)
# dp0.8.hn.swc..g90c     <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Swell*Glare90)
# dp0.8.hn.swc.g90c.bfc  <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Swell+Glare90+Clumped_Beaufort)
# dp0.8.hn.swc.g45c.szc  <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Swell+Glare45+Clumped_Group_Size)
# dp0.8.hn.swc..g45c     <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Swell*Glare45)
dp0.8.hn.swc.obs      <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Swell+Observer)
# dp0.8.hn.swc..obs      <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Swell*Observer)
# dp0.8.hn.swc2 <-ds(df.dp, 0.8, key="hn", formula=~Clumped_Swell2)
# dp0.8.hn.ob   <-ds(df.dp, 0.8, key="hn", formula=~Observer)

# dp0.8.hn.gl   <-ds(df.dp, 0.8, key="hn", formula=~glare_swath)
# dp0.8.hn.gl45   <-ds(df.dp, 0.8, key="hn", formula=~glare_swath45) # none fit

# From Feb
# hn.swc.gl0.9  <- ds(data=df.dp, truncation=0.9, key="hn", formula=~Clumped_Swell+glare)
# hn.swc0.9     <- ds(data=df.dp, truncation=0.9, key="hn", formula=~Clumped_Swell)
# hr.swc.szc0.9  <-ds(data=df.dp, truncation=0.9, key="hr", formula=~Clumped_Swell+Clumped_Group_Size)
# 
# hn.0.9        <- ds(data=df.dp, truncation=0.9, key="hn")
# hn.gl0.9      <- ds(data=df.dp, truncation=0.9, key="hn", formula=~glare)
# un.0.9        <- ds(data=df.dp, truncation=0.9, key="un")
# 
# hr.szc0.9     <- ds(data=df.dp, truncation=0.9, key="hr", formula=~Clumped_Group_Size)
# 
# hn.v0.9       <- ds(data=df.dp, truncation=0.9, key="hn", formula=~Clumped_Vis)
# hn.bfc0.9     <- ds(data=df.dp, truncation=0.9, key="hn", formula=~Clumped_Beaufort)

# save(
# dp0.8.un       ,
# dp0.8.hn  ,
# dp0.8.hn.g90   ,
# dp0.8.hn.swc     ,
# dp0.8.hn.swc.g90c,
# dp0.8.hn.swc.bfc ,
# dp0.8.hn.swc.szc ,
# dp0.8.hn.swc.obs ,
# file="data/dp-models.RData")
# }

dp <- df.dp %>% dplyr::select(Region.Label,
                Sample.Label = order,
                distance,
                Species,
                size = Group_Size,
                Glare90,
                Clumped_Swell)
# find transects with no sightings and create NA distance rows
obs <- full_join(dp, effort) #%>% #left_join(reg) %>% 

dp0.8.hn.swc.g90c <- ds(data=obs, truncation=0.8, key="hn", formula=~Clumped_Swell+Glare90, er_var = "S2") # swell y/n, glare mild/none or severe
 # swell y/n, glare mild/none or severe
# summary(hn.sw.gl0.9)

# encounter rate and group size
er <- dp0.8.hn.swc.g90c$dht$individuals$summary[c(1:4),c(1,5,7,9,10)]  %>% 
  transmute(Season=Region,
            n     =round(n,     digits=0), 
            ER    =round(ER,    digits=2),
            cv.ER =round(cv.ER, digits=2),
            GS=round(mean.size, digits=2))
# abundance
Nhat_t <- dp0.8.hn.swc.g90c$dht$individuals$N[c(1:4),c(1,2,4,5,6)] %>% 
  transmute(Season=Label,
            N=    round(Estimate,digits=0), 
            cv.N= round(cv,      digits=2),
            L95.N=round(lcl,     digits=0),
            U95.N=round(ucl,     digits=0))
# density
d <- dp0.8.hn.swc.g90c$dht$individuals$D[c(1:4),c(1,2,5,6)] %>% 
  transmute(Season=Label,
            D =    round(Estimate*25,digits=2), # *25 cuz density=indivs/25km^2
            # cv.D = round(cv,         digits=2),
            L95.D= round(lcl*25,     digits=2),
            U95.D= round(ucl*25,     digits=2))

ab_dp <- full_join(er, Nhat_t) %>% full_join(d) %>% tibble::as_tibble()  %>% dplyr::select(1:6,8:12,7) 
  # mutate_if(is.numeric, round, digits = 2) 
# ab_dp_data <- ab_dp[order(ab_dp$N),]
```

```{r df-tab-dp}
model.table.dp <- summarize_ds_models(
dp0.8.un       ,
dp0.8.hn  ,
dp0.8.hn.g90   ,
dp0.8.hn.swc     ,
dp0.8.hn.swc.g90c,
dp0.8.hn.swc.bfc ,
dp0.8.hn.swc.szc ,
dp0.8.hn.swc.obs ,
  output="plain") %>% tibble::as_tibble()  %>% 
  rename("SE (Average detect.)"="se(Average detectability)",
         "Average detect."="Average detectability",
         "CvM p-value"="C-vM $p$-value") %>% 
  mutate(Formula=gsub("Clumped_","",Formula)) %>% dplyr::select(-Model)

model.table.dp$Formula <- gsub("Vis","Visibility",model.table.dp$Formula)

# pdf <- knitr:::is_latex_output()
model.table.dp %>%
  csas_table(
    
    escape = FALSE, font_size=9,
             align = c("l","r","r","r","r","r"), digits=2,  longtable = F,
  caption = paste("Dall's porpoise detection function models; truncation distance=0.8 km. Comparison among models with strong support (i.e. top performing model plus the two with lowest delta AIC). Key function, Formula=covariates in model, CvM p-value=Cramer-von-Mises test p-value, Average detect.=average detectability, SE(Average detect.)=standard error of the average detectability. Delta AIC= difference in AIC from the top performing model.")) %>%
  kableExtra::column_spec(c(1:6), width = c("1.6in", "1.2in",".7in",".7in","0.7in",".7in"))

```

(ref:cap-ab-hw) Humpback whale abundance estimates. n=number of groups sighted, ER=encounter rate (per km), cv.ER=coefficient of variation of the encounter rate, GS=estimated group size, N=estimated abundance, D=estimated density (per 25 km^2^), L95 and U95=lower and upper bounds of a log-normal 95\% confidence interval, cv=coefficient of variation of the abundance and density estimates.

```{r tab-ab-hw}
names(ab_hw) <- c("Season","n","ER","cv.ER","GS","N","L95.N","U95.N","D","L95.D","U95.D","cv")
# names(ab_hw) <- c("SeasonYear","n","ER","cv.ER","GS","N","L95.N","U95.N","D","L95.D","U95.D","cv")
ab_hw %>% tibble::as_tibble() %>% 
  csas_table(
    
    font_size=9, 
    # align=rep('l', 13),
    # escape = FALSE,
    longtable = F,
    caption = "(ref:cap-ab-hw)")
# write.csv(ab_hw[1:10,], "C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hw/hw early seasonYear abund.csv", row.names = F)
#   kableExtra::column_spec(c(1:13), width = rep(".6in",13))
```

(ref:cap-ab-hp) Harbour porpoise abundance estimates. n=number of groups sighted, ER=encounter rate (per km), cv.ER=coefficient of variation of the encounter rate, GS=estimated group size, N=estimated abundance, D=estimated density (per 25 km^2^), L95 and U95=lower and upper bounds of a log-normal 95\% confidence interval, cv=coefficient of variation of the abundance and density estimates.

```{r tab-ab-hp}
names(ab_hp) <- c("Season","n","ER","cv.ER","GS","N","L95.N","U95.N","D","L95.D","U95.D","cv")
# names(ab_hp) <- c("SeasonYear","n","ER","cv.ER","GS","N","L95.N","U95.N","D","L95.D","U95.D","cv")
ab_hp %>% tibble::as_tibble()  %>% 
  csas_table(
     
    font_size=9,
    # escape = T,
    longtable = F,
    caption = "(ref:cap-ab-hp)")
# write.csv(ab_hp[1:10,], "C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hp/hp early seasonYear abund.csv", row.names = F)
# 
```

(ref:cap-ab-dp) Dall's porpoise abundance estimates. n=number of groups sighted, ER=encounter rate (per km), cv.ER=coefficient of variation of the encounter rate, GS=estimated group size, N=estimated abundance, D=estimated density (per 25 km^2^), L95 and U95=lower and upper bounds of a log-normal 95\% confidence interval, cv=coefficient of variation of the abundance and density estimates.

```{r tab-ab-dp}
names(ab_dp) <- c("Season","n","ER","cv.ER","GS","N","L95.N","U95.N","D","L95.D","U95.D","cv")
# names(ab_dp) <- c("SeasonYear","n","ER","cv.ER","GS","N","L95.N","U95.N","D","L95.D","U95.D","cv")
ab_dp %>% tibble::as_tibble()  %>% 
  csas_table(
     
    font_size=9,
    # escape = FALSE,
    longtable = F,
    caption = "(ref:cap-ab-dp)")
# write.csv(ab_dp[1:10,], "C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/dp/dp early seasonYear abund.csv", row.names = F)

```


\newpage



```{r load spatial files, results = FALSE}
# ----------------- LOAD SPATIAL FILES --------------------------------
# bc coast for plotting
dir <- "C:/Users/KeppelE/Documents/CeMoRe/Analysis/cemore_analysis/shapefiles"
if(!exists("coast")){
  coast <- sf::st_read(dsn = dir, layer = "BC_AK_WA_union_polygon")%>% st_transform(3156) #BC_coast_UTM9  BC_AK_WA_union_polygon
  # coast <- sf::st_read(dsn = dir, layer = "BC_coast_UTM9")%>% st_transform(3156) #BC_coast_UTM9  BC_AK_WA_union_polygon
}

# if(!exists("p_sf")){
# ss <- rast("C:/users/keppele/documents/cemore/analysis/cemore_analysis/required shapefiles/SS_Bathymetry.tif")
# # pe <- as.polygons(ext(ss))
# pr <- as.polygons(ss > -Inf)
# p_sf <- st_as_sf(pr)
# }

if(!exists("locations")){
  locations <- sf::st_read(dsn = dir, layer = "locations")
  locations[which(locations$TextString=="Juan de Fuca Strait"),]$YOffset<-0.03
  locations[which(locations$TextString=="Juan de Fuca Strait"),]$XOffset<-0.12
  locations[which(locations$TextString=="Juan de Fuca Strait"),]$TextString <- "Juan de Fuca\nStrait"
  # locations[which(locations$TextString=="Haro Strait"),]$YOffset<-0.15
  # locations[which(locations$TextString=="Swiftsure Bank"),]$YOffset<-0.02
  # locations[which(locations$TextString=="Swiftsure Bank"),]$XOffset<--0.02
  locations[which(locations$TextString=="Haro Strait"),]$YOffset<--0.01
  # locations[which(locations$TextString=="Can"),]$YOffset <- 0.02
  locations[which(!locations$TextString%in%c("Can","US")),]$Angle <- 0
  # locations$FontSize <- 16
  locations %<>% filter(!TextString == "Swiftsure Bank") 
}
if(!exists("canada_shp")){
  canada_shp <- st_read(dsn = dir, "CanadianEEZ") %>% st_transform(crs=3156)
}
if(!exists("tss")){
  tss <- st_read(dsn = dir, "SBC_TSS_SIMPLE") %>% st_transform(crs=3156)
}

if(!exists("survey_area")){
  survey_area <- sf::st_read(dsn = dir, layer = "Full_study_area_UTM9N") %>% st_union()
  survey_can <- st_intersection(survey_area,canada_shp)
  canada_shp %<>% st_cast("MULTILINESTRING")
}

# w <- data.frame(
#   lat1=49+17/60,
#   long1=-122-57/60)
# w = st_as_sf(w, coords = c("long1","lat1"), remove = FALSE, crs=4326) %>% st_transform(3156)
# w$TextString <- "Westridge\nMarine\nTerminal"

# if(!exists("d")){
# d <- st_read(dsn = x, layer = "less_than_5m") %>% st_transform(crs = 4326)
# }
coord <- ggplot2::coord_sf(xlim = c(-125.5, -122.9), ylim = c(48.1, 49.44), crs = sf::st_crs(4326))

# create bathymetric layer
bathy <- getNOAA.bathy(-125.7, -122.5,48, 49.5,res=1, keep=TRUE) %>%
  fortify(bathy)
bathy$z[which(bathy$z >= 0)] <- 0
col <- rev(RColorBrewer::brewer.pal(9L, "Blues")[4:7])
col_ramp <- colorRampPalette(col)

# make bathy legend
b_leg <- ggplot() +
  geom_raster(aes(x=x,y=y,fill = z), data = bathy) +
  labs(fill = "Depth (m)") +
  scale_fill_gradientn(colours = col_ramp(20)) +
  theme(legend.position = "bottom") +
  guides(fill = guide_colorbar(title.position = "top"))
leg1 <- cowplot::get_legend(b_leg)

coast_file <- coast
base_map <- ggplot() +
  geom_raster(aes(x=x,y=y,fill = z), data = bathy) +  #labs(fill = "Depth (m)") +
  scale_fill_gradientn(colours = col_ramp(20), guide = "none") +
  ggnewscale::new_scale("fill") +
  geom_sf(data = coast_file, stroke = 0.05, fill = "light yellow", colour = "grey 60") +
  guides(alpha= "none") +
  ylab("")+xlab("")

# theme(axis.text.x = element_text(angle = 90))
```

```{r study-area, results='hide'}

# bl <- RColorBrewer::brewer.pal(11L, "RdYlBu")[8]
study_area <- ggplot() +
  # geom_raster(aes(x=x,y=y,fill = z), data = bathy) +  #labs(fill = "Depth (m)") +
  # scale_fill_gradientn(colours = col_ramp(20), guide = "none") +
  # ggnewscale::new_scale("fill") +
  theme(panel.background = element_rect(fill="grey90"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())+
  # geom_sf(aes(alpha = "Salish\nSea"), stroke=3,data = p_sf, fill=bl, colour=bl) +
  scale_alpha_manual(values=1)+
  geom_sf(data = tss, aes(fill = "Traffic\nSeparation\nScheme"), colour=RColorBrewer::brewer.pal(9,"Oranges")[3]) +
  # geom_sf(data = survey_area, aes(colour = "Full\nStudy\nArea"),
  #         fill=NA,alpha=0.3)+
  geom_sf_pattern(data = survey_can, fill = NA, colour='grey50', size=2,aes(pattern_fill = "Salish Sea/\nSwiftsure Bank\nStudy Area"),
                  pattern_spacing = 0.02, pattern = "stripe", pattern_size = 0.05)+
  coord_fixed(ratio = 1/2)+
  geom_sf(data = canada_shp, aes(linetype = "Can-US\nborder"), fill=NA,colour="red") +

  # scale_colour_manual(values = 'grey50') +
  scale_fill_manual(values = RColorBrewer::brewer.pal(9,"Oranges")[3]) +
  scale_pattern_fill_manual(values = 'grey70') +
  scale_linetype_manual(values = c(5)) +
  labs(fill='',colour = '',pattern_fill='',linetype='',shape='')+
  guides(fill=guide_legend(order=1),
         colour = guide_legend(order =2),
         pattern_fill =guide_legend(order=3),
         linetype = guide_legend(title = NULL, order =4),
         # shape=guide_legend(title=NULL, order=5),
         alpha=guide_legend(title=NULL, order=5)) +
  theme(legend.position = "bottom",
        legend.text = element_text(size=fig_legend_size),
        legend.key = element_blank(),
        legend.spacing = unit(c(-0.4,-0.4), "lines"),
        plot.margin = unit(c(-0.2,-1,0,-1,0), "cm"),
        axis.text=element_text(size=fig_axis_size)
  ) +
  geom_sf(data = coast_file, stroke = 0.0, fill = "light yellow", colour = "grey 60") +
  # geom_sf(data=w,aes(shape=TextString),size=3)+
  geom_sf_text(data = locations, aes(label = TextString,
                                     angle = Angle),
               nudge_x = locations$XOffset,
               nudge_y = locations$YOffset,
               size = 3,
               colour="black"
               # ,fontface="bold"
               )+
  coord+
  ylab("")+xlab("")
#--- trying to make legend at bottom to make image larger
# theme(
#   # legend.position = "bottom",
#           legend.margin = margin(0),
#           legend.key.size = unit(0.1,"cm"),
#     plot.margin = margin(t=0,r=0,b=0,l=0))

ggsave(paste0("knitr-figs-pdf/","study_area.png"),plot=study_area)
  plot_crop(paste0("knitr-figs-pdf/","study_area.png"))
```

\newpage

```{r plot-study-area, fig.width=12,fig.cap="Study area, highlighting the inbound and outbound shipping lanes (traffic separation scheme, TSS), and the study area."}  
  knitr::include_graphics(paste0("knitr-figs-pdf/","study_area.png"))
```

```{r seasonal-track,results='hide'}
par(mar=c(0,0,0,0))
# png("knitr-figs-pdf/test.png")
p <-
  suppressMessages(plot_survey(
  # data=all_ap_sf,
  # Save = T,
  # file_name = "cemore_seasonYear_effort_to 2022_oct.png",
  data.source="cemore",
  bath=F,
  border = T,
  single_survey = F,
  incidentals=F,
  hydrophone=F,
  plot_effort = T, # T/F
  plot_sgt = F,
  # effort_data = all_effort_lines,
  season=  T,

  N=T,
  km=T,
  depth=F,
  by_seasonYear=T,
  colour_month=T,
  leg.pos = "right"))
# dev.off()
  suppressMessages(ggsave("knitr-figs-pdf/seasonal_track.png"))
plot_crop("knitr-figs-pdf/seasonal_track.png", quiet=T)
```


```{r plot-seasonal-track, echo=F,fig.width=12, fig.cap="Realized seasonal survey effort from September 2020 to October 2022. Number of monthly surveys conducted and total realized effort in km displayed by season. Winter = January through March, spring = April through June, summer = July through September, fall = October through December."}
knitr::include_graphics("knitr-figs-pdf/seasonal_track.png")
```

```{r plot-sp-monthly, echo=F}
# plot_sp_monthly <- function(species=sp,
#                             sightings_data=all_ap_sf,
#                             effort_data=all_effort_lines){
#   ap_sf <- sightings_data %>% filter(Species %like% species)
#   ap_sf$Species %<>% droplevels()
#   # to order legend symbols consistently
#   sp <- unique(c(levels(ap_sf$Species)))
# 
#   # create text dataframe for labels
#   tx <- effort_data %>%
#     as.data.frame() %>%
#     dplyr::group_by(month_abb) %>%
#     dplyr::summarise(dist = round(sum(length_km),0),
#                      lab=list(unique(year))) %>%
#     mutate(lab=Map(
#       function(x,y) paste(x, paste(y,collapse=", "),sep = " "),
#       month_abb,lab) %>%
#         unlist()) %>%
#     arrange(month_abb) %>%
#     mutate(lab= factor(lab,levels=c(unique(.$lab),"Dec - 0 years")))%>%
#     as.data.frame()
#   tx[nrow(tx) + 1,] <- c("Dec",0, "Dec - 0 years")
# 
#   # add labels to spatial data frames for facetting
#   effort_lines <- sp::merge(effort_data, tx, by="month_abb")
#   ap_sf <- sp::merge(ap_sf, tx, by="month_abb")
#   
# b <- RColorBrewer::brewer.pal (11,"RdYlBu")[11]
# g <- RColorBrewer::brewer.pal (11,"PRGn")[10]
# y <- RColorBrewer::brewer.pal (9,"YlOrBr")[5]
# br <- RColorBrewer::brewer.pal (9,"RdGy")[1]
# seasons <- c(b,g,y,br)
#   
#   p <- base_map +
#     geom_sf(data = effort_lines, stroke = 0.25,colour="grey50")+
#     geom_sf(data = ap_sf, stroke = 0.01, aes(colour=season, size = Clumped_Group_Size)) +#
#     scale_colour_manual(values=seasons)+
#     scale_size_manual(values = c(1.5,2,2.5,3), name = "Number of Individuals") +
#     coord +
#       guides(colour= "none") +
#     # ggtitle(paste0("Monthly ", sp, " sightings")) +
#     theme(legend.position = "bottom",
#           legend.key = element_blank(),
#           # legend.margin = margin(0),
#           # legend.key.size = unit(0.1,"cm"),
#           legend.text = element_text(size=fig_legend_size),
#           axis.text=element_text(size=fig_axis_size),
#           axis.text.x=element_text(angle=90),
#           plot.margin = unit(c(0,0,0,0), "cm"),
#   panel.background = element_blank(),
#   panel.border = element_blank())+
#     scale_x_continuous(breaks = seq(from = -123, to = -125.5, by = -1)) +
#     scale_y_continuous(breaks = seq(from = 48.2, to = 49.4, by = 0.4), limits = c(48.0,49.5)) +
#     geom_text(data = tx, aes(x = -124.3, y = 48.8, label = paste0(dist, " km")), size = 3) +
# 
#     facet_wrap(~lab, drop = F, ncol=3)
#   
#     # ggdraw(p) +
#     # draw_label("Winter", x = 0, y = 0.87, hjust = 0, vjust = 0,size=10, angle=90)+
#     # draw_label("Spring", x = 0, y = 0.65, hjust = 0, vjust = 0,size=10, angle=90)+
#     # draw_label("Summer", x = 0, y = 0.45, hjust = 0, vjust = 0,size=10, angle=90)+
#     # draw_label("Fall", x   = 0, y = 0.24, hjust = 0, vjust = 0,size=10, angle=90)
# 
#   ggsave(paste0("knitr-figs-pdf/",sp,"_monthly_stg_map.png"),plot=p)
#   plot_crop(paste0("knitr-figs-pdf/",sp,"_monthly_stg_map.png"))
#   knitr::include_graphics(paste0("knitr-figs-pdf/",sp,"_monthly_stg_map.png"))
# }

```


```{r monthly-hw, echo=FALSE,fig.width=12,fig.cap="Humpback whale on-effort sightings and realized survey effort by month from September 2020 to October 2022. No surveys have yet been conducted in December. Monthly data are pooled over years. Relative point size indicates group size for each sighting. Total realized effort in km displayed by month. Months are grouped into seasons across rows. Blue = winter, green = spring, orange = summer, and red = fall."}
sp <- "humpback"
# png("figs/seasonYear_hw.png") 
plot_survey(
  bath=F,
  # save=T,
  # high_res=T,
  # file_name = "figs/seasonYear_hw.png",
  # data=ap_sf2022,
  border=F,
  single_survey=F,
  plot_sgt=T,
  plot_effort = T,
  # effort_data = effort_lines2022,
  # show_transit=F,
  # N=T,
  # km=T,
  # depth=T,
  legend = T,
  leg.pos= "bottom",
  species=sp,
  season=F,
  by_seasonYear = T)
# dev.off()
suppressMessages(ggsave(paste0("knitr-figs-pdf/",sp,"_seasonYear_stg_map.png")))
plot_crop(paste0("knitr-figs-pdf/",sp,"_seasonYear_stg_map.png"), quiet=T)

knitr::include_graphics(paste0("knitr-figs-pdf/",sp,"_seasonYear_stg_map.png"))

```


```{r monthly-hp, echo=FALSE,fig.width=12,fig.cap="Harbour porpoise on-effort sightings and realized survey effort by month from September 2020 to October 2022. No surveys have yet been conducted in December. Monthly data are pooled over years. Relative point size indicates group size for each sighting. Total realized effort in km displayed by month. Months are grouped into seasons across rows. Blue = winter, green = spring, orange = summer, and red = fall."}
sp <- "harbour porpoise"
plot_survey(
  bath=F,
  # save=T,
  # high_res=T,
  # file_name = "figs/seasonYear_hw.png",
  # data=ap_sf2022,
  border=F,
  single_survey=F,
  plot_sgt=T,
  plot_effort = T,
  # effort_data = effort_lines2022,
  # show_transit=F,
  N=T,
  km=T,
  # depth=T,
  legend = F,
  species=sp,
  season=F,
  by_seasonYear = T)
# dev.off()
 suppressMessages(ggsave(paste0("knitr-figs-pdf/",sp,"_seasonYear_stg_map.png")))
plot_crop(paste0("knitr-figs-pdf/",sp,"_seasonYear_stg_map.png"), quiet=T)

knitr::include_graphics(paste0("knitr-figs-pdf/",sp,"_seasonYear_stg_map.png"))

```


```{r monthly-dp, echo=FALSE,fig.width=12,fig.cap="Dall's porpoise on-effort sightings and realized survey effort by month from September 2020 to October 2022. No surveys have yet been conducted in December. Monthly data are pooled over years. Relative point size indicates group size for each sighting. Total realized effort in km displayed by month. Months are grouped into seasons across rows. Blue = winter, green = spring, orange = summer, and red = fall."}
sp <- "Dall's porpoise"
plot_survey(
  bath=F,
  # save=T,
  # high_res=T,
  # file_name = "figs/seasonYear_hw.png",
  # data=ap_sf2022,
  border=F,
  single_survey=F,
  plot_sgt=T,
  plot_effort = T,
  # effort_data = effort_lines2022,
  # show_transit=F,
  N=T,
  km=T,
  # depth=T,
  legend = F,
  species=sp,
  season=F,
  by_seasonYear = T)
# dev.off()
suppressMessages(ggsave(paste0("knitr-figs-pdf/",sp,"_seasonYear_stg_map.png")))
plot_crop(paste0("knitr-figs-pdf/",sp,"_seasonYear_stg_map.png"), quiet=T)

knitr::include_graphics(paste0("knitr-figs-pdf/",sp,"_seasonYear_stg_map.png"))
```


```{r non-target-sp, results='hide'}
 lev <- c("Pacific white-sided dolphin", levels(all_ap_sf$Species)) %>% first_up()
x <- get_all_raw_sgt(single=F) %>%
  # mutate(Species=tolower(Species)) %>% 
  mutate(Species = first_up(as.character(Species)),
         Species = factor(Species, lev)) %>%
  filter(!Species %like% c("Humpback") & !Species %like% "porpoise") %>%
  tidyr::separate(GPS.Pos, into = c("lat", "lon"), sep = "N") 
x1 <- x[1:90,] %>%
  dplyr::mutate(lon = substr(lon, 2, nchar(lon)-3)) %>%
  dplyr::mutate(lat = substr(lat, 1, nchar(lat)-2)) %>% 
  tidyr::separate(lon, into = c("lon.deg", "lon.min"), sep = " ") %>%
  tidyr::separate(lat, into = c("lat.deg", "lat.min"), sep = " ") %>%
  mutate(lon = -(as.numeric(lon.deg) + as.numeric(lon.min)/60),
         lat = as.numeric(lat.deg) + as.numeric(lat.min)/60,
         Group_Size = Best.Cnt,
         month=month(date))
x2 <- x[91:94,] %>%
  dplyr::mutate(lon = substr(lon, 2, nchar(lon)-2)) %>%
  dplyr::mutate(lat = substr(lat, 1, nchar(lat)-1)) %>% 
  tidyr::separate(lon, into = c("lon.deg", "lon.min", "lon.sec"), sep = " ") %>%
  tidyr::separate(lat, into = c("lat.deg", "lat.min", "lat.sec"), sep = " ") %>%
  mutate(lon = -(as.numeric(lon.deg) + as.numeric(lon.min)/60 +as.numeric(lon.sec)/60),
         lat = as.numeric(lat.deg) + as.numeric(lat.min)/60 + as.numeric(lat.sec)/60,
         Group_Size = Best.Cnt,
         month=month(date)) %>% 
  dplyr::select(-c(lon.sec, lat.sec))
x <- rbind(x1,x2) %>% 
  st_as_sf(coords = c("lon", "lat"), crs = 4326) %>% 
  mutate(
    year=year(date),
    season = factor(dplyr::case_when(
      month %in% c(1:3) ~ "Winter",
      month %in% c(4:6) ~ "Spring",
      month %in% c(7:9) ~ "Summer",
      month %in% c(10:12)  ~ "Fall"
    ), levels = c("Winter", "Spring", "Summer", "Fall")),
    Group_Size=Best.Cnt,
    seasonYear = paste0(tolower(season), year),
    seasonYear = factor(seasonYear, levels = unique(seasonYear))) %>% 
  dplyr::select(month,Species,Group_Size, geometry, year, season, seasonYear) #%>%
  # dplyr::filter(!month==1 | !Species=="killer whale - Bigg's") ??
x$Species %<>% droplevels()

# fin <- data.frame(month=NA,Species="Fin whale", Group_Size=1, lat=48.432627, lon=-124.387090) %>% st_as_sf(coords=c("lon","lat"), crs=4326) 
# x <- rbind(x,fin)

# to order legend symbols consistently
sp <- levels(x$Species)
pal <- brewer.pal(9, "Set1")[c(1:9)]

cols <-   c("Humpback whale" = pal[1],
            "Harbour porpoise" = pal[3],
            "Dall\'s porpoise" = pal[4],
            "Unknown porpoise" = pal[6],
            "Killer whale - northern resident" = "black",
            "Killer whale - southern resident" = "black",
            "Killer whale - Bigg\'s" = "black",
            "Killer whale - unknown ecotype" = "black",
            "Fin whale" = pal[5], # orange
            "Grey whale" = pal[9], # grey
            "Minke whale" = pal[7]) # brown

  shape <- c("Humpback whale" = 21,
             "Harbour porpoise" = 21,
             "Dall\'s porpoise" = 21,
             "Unknown porpoise" = 21,
             "Killer whale - northern resident" = 24,
             "Killer whale - southern resident" = 25,
             "Killer whale - Bigg\'s" = 21,
             "Killer whale - unknown ecotype" = 22,
             "Fin whale" = 21, 
             "Grey whale" = 21,
             "Minke whale" = 21)

non_target <- base_map +
  geom_sf(data = x, stroke = 0, size=3,alpha = 1, aes(fill = Species, shape = Species)) +#, size = Clumped_Group_Size
  # scale_size_manual(values = c(1.5,2,2.5,3), name = "Group Size") +
  scale_fill_manual(values = cols, name =NULL, breaks = sp)   +
  scale_shape_manual(values = shape, name = NULL, breaks = sp) +

  guides(alpha= "none") +
  guides(shape = guide_legend(override.aes = list(size=3), order = 1)) +
  guides(fill = guide_legend(order = 1,ncol=2)) +
  # guides(size = guide_legend(order = 2)) +
  theme(legend.position = "bottom",
        legend.key = element_blank(),
        axis.text=element_text(size=fig_axis_size),
        legend.text=element_text(size=fig_legend_size),
        legend.margin = margin(0)
)+ facet_grid(~season) +
  coord

sp <- unique(x$Species)
plot_survey(
  sgt_data=x,
  bath=F,
  # save=T,
  # high_res=T,
  # file_name = "figs/seasonYear_hw.png",
  # data=ap_sf2022,
  border=F,
  single_survey=F,
  plot_sgt=T,
  plot_effort = T,
  # effort_data = effort_lines2022,
  # show_transit=F,
  N=T,
  km=T,
  # depth=T,
  legend = T,
  species=sp,
  season=T,
  by_seasonYear = F)
suppressMessages(ggsave("knitr-figs-pdf/non_target.png",non_target))
plot_crop("knitr-figs-pdf/non_target.png", quiet=T)
# spp + ggtitle(paste0("CeMoRe Survey Non-Target Species Sightings"))
```

```{r plot-non-target, echo=FALSE,fig.width=12, fig.cap="Detections of species (killer whales, fin whales, grey whales, and minke whales) with insufficient sightings to fit detection functions. Includes detections during on-effort surveying and off-effort transiting."}
knitr::include_graphics("knitr-figs-pdf/non_target.png")

```

```{r gof-hw,fig.keep = "none", include=F}
gof_hw <- (gof_ds(hw1.5.hn.v))
```

```{r plot-df-hw, fig.cap="a) Histogram of perpendicular sighting distances of humpback whales with the selected detection function model (half-normal key function with covariates of visibility and glare mild/none or severe to +/- 90 degrees). The key function of the model, effective strip half-width (esw) and number of individual humpback whales sighted (N, within truncation of 1.5 km) are included. The dotted line indicates where estimated detection probability is 0.15. b) Q-Q plot (fitted cumulative distribution (cdf) against empirical cdf) for the selected detection function model for assessment of goodness of fit."}

cols <- NULL
par(mfrow=c(1,2))
  plot_df("humpback whale", hw1.5.hn.v,showpoints=F)
  usr <- par("usr")   # save old user/default/system coordinates
  par(usr = c(0, 1, 0, 1)) # new relative user coordinates
  text(x=0.95,y=1,label="a", adj=c(1,1))
  par(usr = usr)

  invisible(gof_ds(hw1.5.hn.v))
  usr <- par("usr")   # save old user/default/system coordinates
  par(usr = c(0, 1, 0, 1)) # new relative user coordinates
  text(x=0.95,y=1,label="b", adj=c(1,1))
  par(usr = usr) # restore original user coordinates
```

```{r violin-hw-vis, fig.cap="Distribution of perpendicular distances of humpback whale detections at visibility categories of good/excellent/moderate, and poor."}
hw1.5 <- all_ap_sf %>% dplyr::filter(Species=="humpback whale",distance<1.5)
hw_sum_v <- hw1.5 %>% data.frame() %>% count(Clumped_Visibility)

ggplot(data = hw1.5, aes(x=Clumped_Visibility, y=distance)) +
  geom_violin()+
  # stat_summary(fun=mean, geom="pointrange", shape=23, size=2)
  geom_boxplot(width=0.1)+
  geom_text(data=hw_sum_v,
            aes(Clumped_Visibility,max(hw1.5$distance)+(0.05*max(hw1.5$distance)),label=n,size=0.1),size=3,vjust = -0.5)+
  # stat_summary(fun.data=mean_sdl, geom="pointrange")+
  ylab("Perpendicular sighting distance (km)")+
  xlab("Visibility (Good/Moderate vs. Poor)")
#------------------------------------------------------------

hw_sum_gl <- hw1.5 %>% data.frame() %>% count(Glare90)

ggplot(data = hw1.5, aes(x=Glare90, y=distance)) +
  geom_violin()+
  # stat_summary(fun=mean, geom="pointrange", shape=23, size=2)
  geom_boxplot(width=0.1)+
  geom_text(data=hw_sum_gl,
            aes(Glare90,max(hw1.5$distance)+(0.05*max(hw1.5$distance)),label=n,size=0.1),size=3,vjust = -0.5)+
  # stat_summary(fun.data=mean_sdl, geom="pointrange")+
  ylab("Perpendicular sighting distance (km)")+
  xlab("Glare90")
plot(hw1.5$glare_swath,    hw1.5$distance)
plot(hw1.5$glare_swath45,  hw1.5$distance)
#------------------------------------------------------------

hw1.5 %<>% mutate(Beaufort=as.character(Beaufort))
hw_sum_bf <- hw1.5 %>% data.frame() %>% count(Beaufort)

ggplot(data = hw1.5, aes(x=Beaufort, y=distance)) +
  geom_violin()+
  # stat_summary(fun=mean, geom="pointrange", shape=23, size=2)
  geom_boxplot(width=0.1)+
  geom_text(data=hw_sum_bf,
            aes(Beaufort,max(hw1.5$distance)+(0.05*max(hw1.5$distance)),label=n,size=0.1),size=3,vjust = -0.5)+
  # stat_summary(fun.data=mean_sdl, geom="pointrange")+
  ylab("Perpendicular sighting distance (km)")+
  xlab("Beaufort")


#------------------------------------------------------------

hw_sum_bfc <- hw1.5 %>% data.frame() %>% count(Clumped_Beaufort)

ggplot(data = hw1.5, aes(x=Clumped_Beaufort, y=distance)) +
  geom_violin()+
  # stat_summary(fun=mean, geom="pointrange", shape=23, size=2)
  geom_boxplot(width=0.1)+
  geom_text(data=hw_sum_bfc,
            aes(Clumped_Beaufort,max(hw1.5$distance)+(0.05*max(hw1.5$distance)),label=n,size=0.1),size=3,vjust = -0.5)+
  # stat_summary(fun.data=mean_sdl, geom="pointrange")+
  ylab("Perpendicular sighting distance (km)")+
  xlab("Clumped_Beaufort")
#------------------------------------------------------------

hw_sum_szc <- hw1.5 %>% data.frame() %>% count(Clumped_Group_Size)

ggplot(data = hw1.5, aes(x=Clumped_Group_Size, y=distance)) +
  geom_violin()+
  # stat_summary(fun=mean, geom="pointrange", shape=23, size=2)
  geom_boxplot(width=0.1)+
  geom_text(data=hw_sum_szc,
            aes(Clumped_Group_Size,max(hw1.5$distance)+(0.05*max(hw1.5$distance)),label=n,size=0.1),size=3,vjust = -0.5)+
  # stat_summary(fun.data=mean_sdl, geom="pointrange")+
  ylab("Perpendicular sighting distance (km)")+
  xlab("Clumped_Group_Size")
```

<!-- ```{r violin-hw-gl, fig.cap="Distribution of perpendicular distances of humpback whale detections at glare categories of mild/none and severe to +/-90 degrees."} -->
<!-- hw1.5 <- all_ap_sf %>% dplyr::filter(Species=="humpback whale",distance<1.5) -->
<!-- hw_sum_gl90c <- hw1.5 %>% data.frame() %>% count(Glare90) # glare clumped as none/mild or severe -->

<!-- ggplot(data = hw1.5, aes(x=Glare90, y=distance)) + -->
<!--   geom_violin()+ -->
<!--   # stat_summary(fun=mean, geom="pointrange", shape=23, size=2) -->
<!--   geom_boxplot(width=0.1)+ -->
<!--   geom_text(data=hw_sum_gl90c, -->
<!--             aes(Glare90,max(hw1.5$distance)+(0.05*max(hw1.5$distance)),label=n,size=0.1),size=3,vjust = -0.5)+ -->
<!--   # stat_summary(fun.data=mean_sdl, geom="pointrange")+ -->
<!--   ylab("Perpendicular sighting distance (km)")+ -->
<!--   xlab("Glare (Mild/None or Severe)") -->

<!-- ``` -->


```{r gof-hp,fig.keep = "none", include=F}
gof_hp <- (gof_ds(hp.0.65.hn.bfc.obs))
```

```{r plot-df-hp, fig.cap="a) Histogram of perpendicular sighting distances of harbour porpoises with the selected detection function model (half-normal key function with Beaufort sea state (0-1, 2, 3+) and observer as covariates). The key function of the model, effective strip half-width (esw) and number of individual harbour porpoises sighted (N, within truncation of 0.65 km) are included. The dotted line indicates where estimated detection probability is 0.15.  b) Q-Q plot (fitted cumulative distribution (cdf) against empirical cdf) for the selected detection function model for assessment of goodness of fit."}

cols <- NULL
par(mfrow=c(1,2))

plot_df("harbour porpoise",hp.0.65.hn.bfc.obs,showpoints=F, bins=15) #breaks=seq(0,0.7,0.05)
usr <- par("usr")   # save old user/default/system coordinates
par(usr = c(0, 1, 0, 1)) # new relative user coordinates
text(x=0.95,y=1,label="a", adj=c(1,1))
par(usr = usr)

invisible(gof_ds(hp.0.65.hn.bfc.obs))
usr <- par("usr")   # save old user/default/system coordinates
par(usr = c(0, 1, 0, 1)) # new relative user coordinates
text(x=0.95,y=1,label="b", adj=c(1,1))
par(usr = usr)  # restore original user coordinates                 

```


```{r violin-hp-bf, fig.cap="Distribution of perpendicular distances of harbour porpoise detections at Beaufort sea state categories of 0-1, 2, and 3+. Harbour porpoise sightings are truncated at a perpendicular distance of 0.65 km. The shape of the violin plots indicate the distribution of the data; i.e. wider sections indicate areas of higher probability that the perpendicular distances will fall in these ranges. Boxplots within the violin plots indicate the median and interquartile ranges of perpendicular distances. The number of harbour porpoise detections at each Beaufort category are included at the top of each plot."}
hp0.65 <- all_ap_sf %>% filter(Species=="harbour porpoise",distance<0.65)

hp_sum <- hp0.65 %>% data.frame() %>% count(Clumped_Beaufort)

# par(mfrow=c(1,2))
ggplot(data = hp0.65, aes(Clumped_Beaufort, distance)) +
  geom_violin() +
  geom_boxplot(width=0.1)+
  geom_text(data=hp_sum,
            aes(Clumped_Beaufort,max(hp0.65$distance)-(0.005*max(hp0.65$distance)),label=paste0("n = ",n)),size=4,vjust = -0.5)+
  ylab("Perpendicular sighting distance (km)")+
  xlab("Beaufort sea state (clumped into groups, 0-1, 2, 3+)")+
  theme(axis.text=element_text(size=fig_axis_size),
        axis.title=element_text(size=fig_axis_title_size))
```


```{r violin-hp-obs, fig.cap="Distribution of perpendicular distances of harbour porpoise detections by unique observer. Harbour porpoise sightings are truncated at a perpendicular distance of 0.65 km. The shape of the violin plots indicate the distribution of the data; i.e. wider sections indicate areas of higher probability that the perpendicular distances will fall in these ranges. Boxplots within the violin plots indicate the median and interquartile ranges of perpendicular distances. The number of harbour porpoise detections by each observer are included at the top of each plot."}
hp0.65 %<>% mutate(Observer=case_when(
  Observer == "a" ~ "Observer 1",
  Observer == "b" ~ "Observer 2",
  Observer == "c" ~ "Observer 3"
)) 

hp_sum2 <- hp0.65 %>% data.frame() %>% count(Observer)

ggplot(data = hp0.65, aes(Observer, distance)) +
  geom_violin() +
  geom_boxplot(width=0.1)+
  geom_text(data=hp_sum2,
            aes(Observer,max(hp0.65$distance)-(0.005*max(hp0.65$distance)),label=paste0("n = ",n)),size=4,vjust = -0.5)+
  ylab("Perpendicular sighting distance (km)")+
  xlab("Observer")+
  theme(axis.text=element_text(size=fig_axis_size),
        axis.title=element_text(size=fig_axis_title_size))

hp_sum3 <- hp0.65 %>% data.frame() %>% count(Clumped_Group_Size2)

ggplot(data = hp0.65, aes(as.character(Clumped_Group_Size2), distance)) +
  geom_violin() +
  geom_boxplot(width=0.1)+
  geom_text(data=hp_sum3,
            aes(as.character(Clumped_Group_Size2),max(hp0.65$distance)-(0.005*max(hp0.65$distance)),label=paste0("n = ",n)),size=4,vjust = -0.5)+
  ylab("Perpendicular sighting distance (km)")+
  xlab("Clumped_Group_Size2")+
  theme(axis.text=element_text(size=fig_axis_size),
        axis.title=element_text(size=fig_axis_title_size))

hp_sum4 <- hp0.65 %>% data.frame() %>% count(Visibility)

ggplot(data = hp0.65, aes(as.character(Visibility), distance)) +
  geom_violin() +
  geom_boxplot(width=0.1)+
  geom_text(data=hp_sum4,
            aes(as.character(Visibility),max(hp0.65$distance)-(0.005*max(hp0.65$distance)),label=paste0("n = ",n)),size=4,vjust = -0.5)+
  ylab("Perpendicular sighting distance (km)")+
  xlab("Visibility")+
  theme(axis.text=element_text(size=fig_axis_size),
        axis.title=element_text(size=fig_axis_title_size))
```


<!-- ```{r violin-hp-gs, fig.cap="Distribution of perpendicular distances of harbour porpoise detections at group sizes of 1, 2, 3 and 4+"} -->
<!-- hp <- all_ap_sf %>% filter(Species=="harbour porpoise",distance<0.7) -->

<!-- hp_sum3 <- hp %>% data.frame() %>% count(Clumped_Group_Size) -->

<!-- # par(mfrow=c(1,2)) -->
<!-- ggplot(data = hp, aes(Clumped_Group_Size, distance)) + -->
<!--   geom_violin() + -->
<!--   geom_boxplot(width=0.1)+ -->
<!--   geom_text(data=hp_sum3, -->
<!--             aes(Clumped_Group_Size,max(hp$distance)-(0.005*max(hp$distance)),label=paste0("n = ",n)), size=4,vjust = -0.5)+ -->
<!--   ylab("Perpendicular sighting distance (km)")+ -->
<!--   xlab("Group size (clumped into groups, 1, 2, 3, 4+)")+ -->
<!--   theme(axis.text=element_text(size=fig_axis_size), -->
<!--         axis.title=element_text(size=fig_axis_title_size)) -->
<!-- ``` -->



```{r gof-dp,fig.keep = "none", include=F}
gof_dp <- (gof_ds(dp0.8.hn.swc.g90c))
```

```{r plot-df-dp, fig.cap="a) Histogram of perpendicular sighting distances of Dalls porpoises with the selected detection function model (half-normal key function with interaction between swell presence/absence and glare (mild/none or severe to +/- 90 degrees) as a covariate). The key function of the model, effective strip half-width (esw) and number of individual Dalls porpoises sighted (N, within truncation of 0.8 km) are included. The dotted line indicates where estimated detection probability is 0.15. b) Q-Q plot (fitted cumulative distribution (cdf) against empirical cdf) for the selected detection function model for assessment of goodness of fit."}
cols <- NULL
par(mfrow=c(1,2))

plot_df("Dall\'s porpoise", dp0.8.hn.swc.g90c,showpoints=F)
usr <- par("usr")   # save old user/default/system coordinates
par(usr = c(0, 1, 0, 1)) # new relative user coordinates
text(x=0.95,y=1,label="a", adj=c(1,1))
par(usr = usr)

invisible(gof_ds(dp0.8.hn.swc.g90c))
usr <- par("usr")   # save old user/default/system coordinates
par(usr = c(0, 1, 0, 1)) # new relative user coordinates
text(x=0.95,y=1,label="b", adj=c(1,1))
par(usr = usr)  # restore original user coordinates                 

```

```{r violin-dp-sw, fig.cap="Distribution of perpendicular distances of Dalls porpoise detections with swell presence/absence. Sightings are truncated at a perpendicular distance of 0.8 km. The shape of the violin plots indicate the distribution of the data; i.e. wider sections indicate areas of higher probability that the perpendicular distances will fall in these ranges. Boxplots within the violin plots indicate the median and interquartile ranges of perpendicular distances. The number of Dalls porpoise detections in each swell category are included at the top of each plot."}
dp <- all_ap_sf %>% filter(Species=="Dall's porpoise",distance<0.8) %>% 
  mutate(interaction=case_when(
    Clumped_Swell == "No swell" & Glare90 == "Mild/None" ~ "No swell & No/Mild glare",
    Clumped_Swell == "No swell" & Glare90 == "Severe" ~ "No swell & Severe glare",
    Clumped_Swell == "Swell" & Glare90 == "Mild/None" ~ "Swell & No/Mild glare",
    Clumped_Swell == "Swell" & Glare90 == "Severe" ~ "Swell & Severe glare"
  ))

# dp_sum <- dp %>% data.frame() %>% count(swell) # none, low, mod-big
dp_sum_c <- dp %>% data.frame() %>% count(Clumped_Swell) # y/n
# dp_sum_c2 <- dp %>% data.frame() %>% count(Clumped_Swell2) # none-low, mod-big

# suppressMessages(ggplot(data = dp, aes(swell, distance))) +
#   geom_violin() +
#   geom_boxplot(width=0.1)+
#   geom_text(data=dp_sum,
#             aes(swell,max(dp$distance)-(0.005*max(dp$distance)),label=paste0("n = ",n)),size=4,vjust = -0.5) +
#   ylab("Perpendicular sighting distance (km)")+
#   xlab(NULL)+
#   theme(axis.text=element_text(size=fig_axis_size),
#         axis.title=element_text(size=fig_axis_title_size))

suppressMessages(ggplot(data = dp, aes(Clumped_Swell, distance))) +
  geom_violin() +
  geom_boxplot(width=0.1)+
  geom_text(data=dp_sum_c,
            aes(Clumped_Swell,max(dp$distance)-(0.005*max(dp$distance)),label=paste0("n = ",n)),size=4,vjust = -0.5)+
  ylab("Perpendicular sighting distance (km)")+
  xlab(NULL)+
  theme(axis.text=element_text(size=fig_axis_size),
        axis.title=element_text(size=fig_axis_title_size))
```

```{r violin-dp-gl, fig.cap="Distribution of perpendicular distances of Dalls porpoise detections with glare none/mild or severe to +/- 90 degrees on both port and starboard. Sightings are truncated at a perpendicular distance of 0.8 km. The shape of the violin plots indicate the distribution of the data; i.e. wider sections indicate areas of higher probability that the perpendicular distances will fall in these ranges. Boxplots within the violin plots indicate the median and interquartile ranges of perpendicular distances. The number of Dalls porpoise detections in each glare category are included at the top of each plot."}
# dp <- all_ap_sf %>% filter(Species=="Dall's porpoise",distance<0.8)
# dp %<>% mutate(Glare90=factor(case_when(
#   Glare90 == "None" ~ "No Glare",
#   !Glare90 == "None" ~ "Glare"),
#   levels=c("No Glare", "Glare")
# ))

dp_sum2 <- dp %>% data.frame() %>% count(Glare90)

suppressMessages(ggplot(data = dp, aes(Glare90, distance))) +
  geom_violin() +
  geom_boxplot(width=0.1)+
  geom_text(data=dp_sum2,
            aes(Glare90,max(dp$distance)-(0.005*max(dp$distance)),label=paste0("n = ",n)),size=4,vjust = -0.5)+
  ylab("Perpendicular sighting distance (km)")+
  xlab(NULL)+
  theme(axis.text=element_text(size=fig_axis_size),
        axis.title=element_text(size=fig_axis_title_size))

# plot(dp$glare_swath, dp$distance)

```

<!-- ```{r violin-dp-sw-gl, fig.cap="Distribution of perpendicular distances of Dalls porpoise detections with interaction between swell presence/absence and glare none/mild or severe to +/- 90 degrees on both port and starboard. Sightings are truncated at a perpendicular distance of 0.8 km. The shape of the violin plots indicate the distribution of the data; i.e. wider sections indicate areas of higher probability that the perpendicular distances will fall in these ranges. Boxplots within the violin plots indicate the median and interquartile ranges of perpendicular distances. The number of Dalls porpoise detections in each swell category are included at the top of each plot."} -->
<!-- dp_sum_i <- dp %>% data.frame() %>% count(interaction)  -->

<!-- suppressMessages(ggplot(data = dp, aes(interaction, distance))) + -->
<!--   geom_violin() + -->
<!--   geom_boxplot(width=0.1)+ -->
<!--   geom_text(data=dp_sum_i, -->
<!--             aes(interaction,max(dp$distance)-(0.005*max(dp$distance)),label=paste0("n = ",n)),size=4,vjust = -0.5)+ -->
<!--   ylab("Perpendicular sighting distance (km)")+ -->
<!--   xlab(NULL)+ -->
<!--   theme(axis.text=element_text(size=fig_axis_size), -->
<!--         axis.title=element_text(size=fig_axis_title_size)) -->
<!-- ``` -->

(ref:cap-plot-ab) Estimated species abundance by season with the lower and upper bounds of a log-normal 95\% confidence interval.

```{r plot-ab, fig.cap = "(ref:cap-plot-ab)"}
# ab_hp <- read.csv("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hp/hp orig seasonYear abund.csv")
# ab_dp <- read.csv("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/dp/dp orig seasonYear abund.csv")
# ab_hw <- read.csv("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hw/hw orig seasonYear abund.csv")

# ab_hp <- read.csv("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hp/hp early seasonYear abund.csv")
# ab_dp <- read.csv("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/dp/dp early seasonYear abund.csv")
# ab_hw <- read.csv("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hw/hw early seasonYear abund.csv")

# ab_hp <- read.csv("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hp/hp late seasonYear abund.csv")
# ab_dp <- read.csv("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/dp/dp late seasonYear abund.csv")
# ab_hw <- read.csv("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hw/hw late seasonYear abund.csv")

plot_ab_hp <- ab_hp[1:4,] %>% dplyr::select(Season, "Estimated Abundance"=N, L95.N, U95.N) %>% mutate(Species = "Harbour porpoise")
plot_ab_dp <- ab_dp[1:4,] %>% dplyr::select(Season, "Estimated Abundance"=N, L95.N, U95.N) %>% mutate(Species = "Dall's porpoise")
plot_ab_hw <- ab_hw[1:4,] %>% dplyr::select(Season, "Estimated Abundance"=N, L95.N, U95.N) %>% mutate(Species = "Humpback whale")

lev <- levels(all_ap_sf$Species) %>% first_up()

plot_ab <- rbind(plot_ab_hp, plot_ab_dp, plot_ab_hw) %>%
  mutate(Species=factor(Species, levels = lev),
         Season=factor(Season, levels = levels(all_ap_sf$season)))
         # SeasonYear=factor(SeasonYear, levels = levels(all_ap_sf$seasonYear)))

# to plot abund est's by seasonYear instead of season
# {
#   # seasonYear_lev <- c("winter2021","winter2022",#"winter2023",
#   #                     "spring2021", "spring2022", 
#   #                     "summer2020","summer2021","summer2022",
#   #                     "fall2020","fall2021","fall2022")
#   seasonYear_lev <- unique(levels(all_ap_sf$seasonYear))
#   plot_ab_hw <- ab_hw[10,] %>% 
#     dplyr::select(SeasonYear, "Estimated Abundance"=N, L95.N, U95.N) %>%
#     mutate(Species = "Humpback whale", SeasonYear=factor(SeasonYear, levels = seasonYear_lev))
#   plot_ab_hp <- ab_hp[10,] %>% 
#     dplyr::select(SeasonYear, "Estimated Abundance"=N, L95.N, U95.N) %>%
#     mutate(Species = "Harbour porpoise", SeasonYear=factor(SeasonYear, levels = seasonYear_lev))
#   plot_ab_dp <- ab_dp[10,] %>% 
#     dplyr::select(SeasonYear, "Estimated Abundance"=N, L95.N, U95.N) %>%
#     mutate(Species = "Dall's porpoise", SeasonYear=factor(SeasonYear, levels = seasonYear_lev))
#     } 
# pal <- brewer.pal(9, "Set1")[c(1:9)]
   {hw <- brewer.pal(8, "Reds")[8]
    hp <- brewer.pal(8, "Greens")[8]
    dp <- brewer.pal(8, "Purples")[8]
    
cols <- c('Humpback whale' = hw,
          'Harbour porpoise' = hp,
          'Dall\'s porpoise' = dp)
shape <- c('Humpback whale' = 23,
           'Harbour porpoise' = 24,
           'Dall\'s porpoise' = 22)}
ggplot(plot_ab, aes(Season, `Estimated Abundance`), colour="black") +
# ggplot(plot_ab_hw, aes(SeasonYear, `Estimated Abundance`), colour="black") +
# ggplot(plot_ab_hp, aes(SeasonYear, `Estimated Abundance`), colour="black") +
# ggplot(plot_ab_dp, aes(SeasonYear, `Estimated Abundance`), colour="black") +
    geom_errorbar(colour = "grey70", aes(
      ymin = L95.N, ymax = U95.N,
      group=Species
      ),
                width=.3,
                position=position_dodge(.3)
                # size=0.8
                ) +
  geom_point(aes(fill=Species,
                 shape=Species),
             size=3.5,
             position=position_dodge(.3)) +
  scale_fill_manual(values=cols)+
  scale_shape_manual(values=shape)+

  theme_classic()+
  theme(legend.text = element_text(size=fig_legend_size),
        legend.title=element_blank(),
        axis.text= element_text(size=fig_axis_size),
        axis.title.y = element_text(size = 14),
        axis.title.x = element_text(size=14),
        axis.text.x = element_text(angle=90))+
  ggtitle("Winter = Jan-Mar, Spring = Apr-Jun, Summer = Jul-Sep, Fall=Oct-Dec") # orig seasonYear
  # ggtitle("Winter = Dec-Feb, Spring = Mar-May, Summer = Jun-Aug, Fall=Sep-Nov") # early seasonYear
  # ggtitle("Winter = Feb-Apr, Spring = May-Jul Summer = Aug-Oct, Fall=Nov-Jan") # late seasonYear
# ggsave("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/early seasonYear abund.png")


# ggsave("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hw/hw orig seasonYear abund.png")
# ggsave("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hp/hp orig seasonYear abund.png")
# ggsave("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/dp/dp orig seasonYear abund.png")


# ggsave("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hw/hw early seasonYear abund.png")
# ggsave("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hp/hp early seasonYear abund.png")
# ggsave("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/dp/dp early seasonYear abund.png")

# ggsave("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hw/hw late seasonYear abund.png")
# ggsave("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/hp/hp late seasonYear abund.png")
# ggsave("C:/users/keppele/documents/cemore/analysis/cemore_analysis/output_cemore/diff seasons/dp/dp late seasonYear abund.png")
```
